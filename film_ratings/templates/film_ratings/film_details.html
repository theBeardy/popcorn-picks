{% extends "base.html" %}
{% load static %}
{% block content %}
  <div class="flex flex-col lg:flex-row justify-center items-start gap-10 p-6 mt-10">
    
    {% if movie.poster_url %}
    <img
      src="{{ movie.poster_url }}"
      class="w-full max-w-xs lg:max-w-sm rounded-lg shadow-lg dark:shadow-black"
      alt="Poster for {{ movie.title }}"
    />
    {% endif %}

    <div class="w-full max-w-2xl">
      <!-- Title and Year -->
      <div class="flex flex-wrap items-end mb-4">
        <h2 class="text-6xl font-default font-extrabold text-light-text dark:text-dark-text mr-4">
          {{ movie.title }}
        </h2>
        {% if movie.release_year %}
        <p class="text-3xl font-default font-normal text-light-text-2 dark:text-dark-text-2">
          ({{ movie.release_year }})
        </p>
        {% endif %}
      </div>

      <!-- Gauge for Average Rating -->
      <div class="relative w-40 h-40 mb-6">
        <svg class="rotate-[135deg] w-full h-full" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
          <circle cx="18" cy="18" r="16" fill="none" class="stroke-current text-accent-light dark:text-accent-dark" stroke-width="1" stroke-dasharray="75 100"></circle>
          <circle cx="18" cy="18" r="16" fill="none" class="stroke-current text-light-4 dark:text-dark-4" stroke-width="2" stroke-dasharray="{% widthratio average_rating 10 75 %} 100"></circle>
        </svg>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center">
          <span class="text-4xl font-comfortaa text-light-text dark:text-dark-text">
            {{ average_rating | floatformat:1 }}
          </span>
        </div>
      </div>

      <!-- Description -->
      {% if movie.description %}
      <p class="mb-6 font-figtree text-light-text dark:text-dark-text">
        <strong>Description:</strong> {{ movie.description }}
      </p>
      {% endif %}

      <!-- Latest Review -->
      {% if latest_review %}
      <ul class="space-y-2 font-figtree text-light-text dark:text-dark-text">
        <li>Visuals: <span class="text-light-text-2 dark:text-dark-text-2">{{ latest_review.visuals }}</span></li>
        <li>Acting: <span class="text-light-text-2 dark:text-dark-text-2">{{ latest_review.acting }}</span></li>
        <li>Thought-Provoking: <span class="text-light-text-2 dark:text-dark-text-2">{{ latest_review.thought_provoking }}</span></li>
        <li>Dialogue: <span class="text-light-text-2 dark:text-dark-text-2">{{ latest_review.dialog }}</span></li>
        <li>Meaningful: <span class="text-light-text-2 dark:text-dark-text-2">{{ latest_review.makes_me_cry }}</span></li>
        <li>Execution of Genre: <span class="text-light-text-2 dark:text-dark-text-2">{{ latest_review.genre_execution }}</span></li>
        <li>Rewatchable: <span class="text-light-text-2 dark:text-dark-text-2">{{ latest_review.rewatchability }}</span></li>
        <li>Fun to Watch: <span class="text-light-text-2 dark:text-dark-text-2">{{ latest_review.fun_to_watch }}</span></li>
      </ul>
      {% else %}
      <p class="text-light-text dark:text-dark-text">No reviews yet for this movie.</p>
      {% endif %}
    </div>
  </div>
  {% if user.is_authenticated %}
  {% comment %} <div class="fixed bottom-10 right-10">
    <div class="">
      <button 
        command="show-modal" 
        commandfor="dialog"
        hx-get="{% url 'film_ratings:review_new' movie.id %}"
        hx-target="#dialog-content"
        hx-swap="innerHTML"
        class="rounded-md bg-gray-950/5 px-2.5 py-1.5 text-sm font-semibold text-gray-900 hover:bg-gray-950/10 dark:bg-white/10 dark:text-white dark:inset-ring dark:inset-ring-white/5 dark:hover:bg-white/20"
      >Review this film</button>
      <el-dialog>
        <dialog id="dialog" aria-labelledby="dialog-title" class="fixed inset-0 z-[9999] size-auto max-h-none max-w-none overflow-y-auto bg-transparent backdrop:bg-transparent">
          <el-dialog-backdrop class="fixed inset-0 bg-gray-500/75 transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in dark:bg-gray-900/50"></el-dialog-backdrop>

          <div tabindex="0" class="flex min-h-full items-end justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0">
            <el-dialog-panel id="dialog-content" class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:w-full sm:max-w-lg lg:max-w-5xl data-closed:sm:translate-y-0 data-closed:sm:scale-95 dark:bg-gray-800 dark:outline dark:-outline-offset-1 dark:outline-white/10">
              <!-- Modal Content goes here-->
            </el-dialog-panel>
          </div>
        </dialog>
      </el-dialog>
    </div>
  </div> {% endcomment %}
  <div class="flex p-6 sm:fixed bottom-10 right-10">
    <button
      id="openModal"
      hx-get="{% url 'film_ratings:review_new' movie.id %}"
      hx-target="#modal-content"
      hx-swap="innerHTML"
      class="rounded-md bg-gray-950/5 px-2.5 py-1.5 sm:text-sm font-alt text-gray-900 hover:bg-gray-950/10 dark:bg-white/10 dark:text-white dark:ring-1 dark:ring-white/5 dark:hover:bg-white/20"
    > <i class="fa-solid fa-pen mr-2"></i>
      Review this film 
    </button>
  </div>

  <!-- Modal -->
  <div
    id="modal"
    class="fixed inset-0 z-[9999] hidden flex items-center justify-center bg-black/50 backdrop-blur-sm"
  >
    <div
      class="relative max-w-3xl max-h-[90vh] p-6"
    >
      <!-- Close button -->
      <button
        id="closeModal"
        class="absolute top-4 right-4 bg-light-2 flex justify-center items-center size-10 rounded-full dark:bg-dark-2 hover:scale-105"
      >
        <i class="fa-solid fa-circle-xmark fa-2xl text-accent-light dark:text-accent-dark"></i>
      </button>

      <!-- Modal content loaded by HTMX -->
      <div id="modal-content">
        <!-- HTMX will inject your form here -->
      </div>
    </div>
  </div>
  {% endif %}
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const modal = document.getElementById("modal");
      const openBtn = document.getElementById("openModal");
      const closeBtn = document.getElementById("closeModal");

      openBtn.addEventListener("click", () => {
        modal.classList.remove("hidden");
        document.body.classList.add("overflow-hidden");
      });

      closeBtn.addEventListener("click", () => {
        modal.classList.add("hidden");
        document.body.classList.remove("overflow-hidden");
      });

      // Optional: close when clicking outside modal box
      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          modal.classList.add("hidden");
          document.body.classList.remove("overflow-hidden");
        }
      });
    });
  </script>
{% endblock %}
